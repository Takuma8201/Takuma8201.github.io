<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>AI同時比較ツール</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }

    h1 { text-align: center; margin-bottom: 20px; }

    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1.1rem;
      box-sizing: border-box;
    }

    button {
      padding: 8px 20px;
      font-size: 1rem;
      margin-top: 8px;
    }

    .box {
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      font-size: 0.95rem;
    }

    .session {
      background: #fff;
      border-radius: 8px;
      padding: 12px 16px;
      margin-top: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }

    .question-title {
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .arrow {
      margin-right: 6px;
      transition: transform 0.2s;
    }

    .collapsed .arrow {
      transform: rotate(-90deg);
    }

    /* 要約以外を折りたたむ */
    .collapsed .answers > :not(.summary) {
      display: none;
    }

    .answer-card {
      background: #fdfdfd;
      padding: 8px;
      margin-top: 8px;
      border-left: 4px solid #4caf50;
      border-radius: 4px;
    }

    .wide {
      background: #f9f9ff;
      padding: 10px;
      margin-top: 10px;
      border-left: 4px solid #2196f3;
      border-radius: 4px;
    }

    .summary {
      border-left-color: #ffb300;
      background: #fffbe6;
    }

    .footer {
      margin-top: 30px;
      padding: 15px;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
      background: #fafafa;
      border-top: 1px solid #ddd;
      border-radius: 8px;
    }
  </style>
</head>

<body>

<h1>AI同時比較ツール</h1>

<!-- AI選択 -->
<div class="box">
  <strong>使用するAI（最大3つ）</strong><br>
  <label><input type="checkbox" class="ai"> gpt-4o-mini</label><br>
  <label><input type="checkbox" class="ai"> gpt-4.1-mini</label><br>
  <label><input type="checkbox" class="ai"> Claude Haiku</label><br>
  <label><input type="checkbox" class="ai"> Gemini Flash</label><br>
  <label><input type="checkbox" class="ai"> Mistral small</label>
</div>

<!-- ジャンル選択 -->
<div class="box">
  <strong>質問ジャンル（矛盾チェック精度に影響）</strong><br>
  <select id="genre" style="margin-top:6px; padding:8px;">
    <option value="numeric" selected>数値（割合・確率・金額）</option>
    <option value="history">歴史（年号・出来事）</option>
    <option value="opinion">意見（主張の違い）</option>
    <option value="trivia">雑学（軽量チェック）</option>
  </select>
</div>

<!-- オプション -->
<div class="box">
  <label><input type="checkbox" id="opt_summary" checked> 要約</label><br>
  <label><input type="checkbox" id="opt_contra" checked> 矛盾点</label><br>
  <label><input type="checkbox" id="opt_freq" checked> 頻出単語</label>
</div>

<!-- 矛盾検出の強度 -->
<div class="box">
  <strong>矛盾検出の強度</strong><br>
  <select id="contra_strength" style="margin-top:6px; padding:8px;">
    <option value="low">弱（明確な矛盾だけ）</option>
    <option value="medium" selected>中（数値・年号の違いを拾う）</option>
    <option value="high">強（前提や条件の違いまで拾う）</option>
  </select>
  <div style="margin-top:6px; color:#666; font-size:0.85rem;">
    ※ 強にすると「前提条件の違い」も矛盾として指摘しやすくなります。
  </div>
</div>

<!-- ✅ コンテキスト（検索エンジン向け説明文） -->
<div class="box">
  <h2 style="margin:0 0 6px; font-size:1rem;">AI同時比較・要約・矛盾検出ツールとは</h2>
  <p style="margin:0 0 6px;">
    本サイトは、複数の生成AIに同じ質問を入力し、それぞれの回答内容を比較することで、
    共通点・違い・数値や前提条件の食い違い（矛盾）を分かりやすく整理・要約するためのツールです。
  </p>
  <p style="margin:0 0 6px;">
    レポート作成や調べ物の場面で、単一のAI回答をそのまま使用するのではなく、
    複数の視点から情報を検証することを目的としています。
  </p>
  <p style="margin:0; color:#666; font-size:0.85rem;">
    ※ 生成AIの回答には誤りが含まれる可能性があります。重要な内容は一次情報で確認してください。
  </p>
</div>

<!-- 質問 -->
<textarea id="question" rows="3" placeholder="質問を入力（200文字まで）"></textarea>
<button onclick="send()">送信</button>

<div id="sessions"></div>

<script>
  const MAX_AI = 3;
  const aiChecks = document.querySelectorAll(".ai");

  aiChecks.forEach(cb => {
    cb.addEventListener("change", () => {
      const count = [...aiChecks].filter(c => c.checked).length;
      if (count > MAX_AI) {
        cb.checked = false;
        alert("AIは最大3つまで選択できます");
      }
    });
  });

  async function send() {
    const q = document.getElementById("question").value.trim();
    if (!q) return alert("質問を入力してください");

    document.getElementById("question").value = "";

    const genre = document.getElementById("genre").value;

    const models = {
      gpt4o: aiChecks[0].checked,
      gpt41: aiChecks[1].checked,
      claude: aiChecks[2].checked,
      gemini: aiChecks[3].checked,
      mistral: aiChecks[4].checked,
    };

    const need_summary =
      document.getElementById("opt_summary").checked ||
      document.getElementById("opt_contra").checked ||
      document.getElementById("opt_freq").checked;

    const session = document.createElement("div");
    session.className = "session collapsed";

    const title = document.createElement("div");
    title.className = "question-title";
    title.innerHTML = `<span class="arrow">▶</span>質問：${q}（${genre}）`;
    title.onclick = () => session.classList.toggle("collapsed");

    const answers = document.createElement("div");
    answers.className = "answers";
    answers.textContent = "AIが思考中です…";

    session.appendChild(title);
    session.appendChild(answers);
    document.getElementById("sessions").prepend(session);

    const res = await fetch("/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        question: q,
        models: models,
        need_summary: need_summary,
        genre: genre
      })
    });

    const data = await res.json();
    answers.innerHTML = "";

    for (const k in data.answers) {
      const d = document.createElement("div");
      d.className =
        k === "summary" ? "wide summary" :
        (k === "contradictions" || k === "frequent_words") ? "wide" :
        "answer-card";

      d.innerHTML = `<strong>${k}</strong><br>${data.answers[k]}`;
      answers.appendChild(d);
    }

    /* 回答が返ってきたら自動展開 */
    session.classList.remove("collapsed");
  }
</script>

<footer class="footer">
  バージョン1　作成日2025年12月2日<br>
  AI回答の違いや矛盾を確認したい方向けの、AI同時比較・要約ツールです。<br>
  <a href="/kiyaku.html">利用規約</a><br>
  <a href="/privacy.html">プライバシーポリシー</a><br>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSdleI9uZln5Yz46S-FnjEU_SWBr73-2dRC5ycCr3hBXsf0Wvg/viewform?usp=dialog"
     target="_blank" rel="noopener">お問い合わせ</a>
</footer>

</body>
</html>
